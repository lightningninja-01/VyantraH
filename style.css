document.addEventListener('DOMContentLoaded', () => {

  const chatIcon = document.getElementById('chatIcon');
  const chatModal = document.getElementById('chatModal');
  const chatOverlay = document.getElementById('chatOverlay');
  const closeChat = document.getElementById('closeChat');
  const chatForm = document.getElementById('chatForm');
  const chatInput = document.getElementById('chatInput');
  const chatMessages = document.getElementById('chatMessages');

  function openChat() {
    chatOverlay.classList.remove('hidden');
    chatModal.classList.remove('hidden');

    chatOverlay.classList.add('visible');
    chatModal.classList.add('visible');

    chatOverlay.style.display = "block";
    chatModal.style.display = "flex";

    setTimeout(() => chatInput.focus(), 120);
  }

  function closeChatWindow() {
    chatModal.classList.remove('visible');
    chatOverlay.classList.remove('visible');

    setTimeout(() => {
      chatModal.classList.add('hidden');
      chatOverlay.classList.add('hidden');
      chatModal.style.display = "none";
      chatOverlay.style.display = "none";
    }, 200);
  }

  function appendMessage(sender, text) {
    const m = document.createElement('div');
    m.className = `msg ${sender}`;
    m.textContent = text;
    chatMessages.appendChild(m);
    chatMessages.scrollTo({ top: chatMessages.scrollHeight, behavior: 'smooth' });
  }

  chatIcon.addEventListener('click', openChat);
  closeChat.addEventListener('click', closeChatWindow);
  chatOverlay.addEventListener('click', closeChatWindow);

  document.addEventListener('keydown', e => {
    if (e.key === "Escape") closeChatWindow();
  });

  chatForm.addEventListener('submit', e => {
    e.preventDefault();
    const text = chatInput.value.trim();
    if (!text) return;
    appendMessage("you", text);
    chatInput.value = "";
    setTimeout(() => appendMessage("bot", "Working on your question…"), 300);
  });

  // DIET PLAN
  window.generatePlan = function () {
    let age = ageInput.value;
    let weight = weightInput.value;
    let height = heightInput.value;

    if (!age || !weight || !height) {
      result.innerHTML = "<p>Please fill all the details.</p>";
      return;
    }

    let activity = parseFloat(activityInput.value);
    let bmr = 10 * weight + 6.25 * height - 5 * age + 5;
    let calories = Math.round(bmr * activity);

    result.innerHTML = `
      <h3>Your Estimated Calories: ${calories}</h3>
      <p>• Eat homemade Indian food.<br>
      • Add fruits.<br>
      • Include dal, paneer, eggs or chana.</p>
    `;
  }

});
